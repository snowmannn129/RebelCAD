# Advanced Assembly Constraints

This directory contains the implementation of advanced assembly constraints for RebelCAD. These constraints extend the basic assembly constraints with additional functionality for complex mechanical systems.

## Overview

Advanced assembly constraints allow for more sophisticated mechanical relationships between components in an assembly. They include:

- **Gear Constraints**: Model gear pairs with specified ratios and mechanical efficiency
- **Cam Constraints**: Model cam-follower relationships with custom cam profiles
- **Path Constraints**: Constrain components to follow specific paths
- **Gear-Rack Constraints**: Model gear-rack mechanisms
- **Belt/Chain Constraints**: Model belt or chain drives with multiple pulleys/sprockets
- **Screw Constraints**: Model screw mechanisms with specified pitch

These constraints not only enforce geometric relationships but also simulate motion and calculate forces and torques.

## Key Features

- **Motion Simulation**: Advanced constraints can simulate motion over time
- **Force and Torque Calculation**: Calculate the forces and torques generated by the constraints
- **Velocity Control**: Set and get the velocities of constrained components
- **Mechanical Efficiency**: Model energy losses in mechanical systems
- **Constraint Enforcement**: Enforce constraints to correct violations
- **Error Measurement**: Measure the degree of constraint violation

## Implementation Details

### Base Classes

- **AssemblyConstraint**: Base class for all assembly constraints
- **AdvancedAssemblyConstraint**: Base class for advanced assembly constraints, extending AssemblyConstraint with motion simulation and force calculation

### Specific Constraints

- **GearConstraint**: Models gear pairs with specified ratios and mechanical efficiency
- **CamConstraint**: Models cam-follower relationships with custom cam profiles
- **PathConstraint**: Constrains components to follow specific paths
- **GearRackConstraint**: Models gear-rack mechanisms with rotation proportional to linear displacement
- **BeltConstraint**: Models belt or chain drives with multiple pulleys/sprockets (planned)
- **ScrewConstraint**: Models screw mechanisms with specified pitch (planned)

## Usage Example

```cpp
// Create two components
auto gear1 = std::make_shared<Component>("Gear1");
auto gear2 = std::make_shared<Component>("Gear2");

// Set their positions
gear1->setPosition(Eigen::Vector3d(0.0, 0.0, 0.0));
gear2->setPosition(Eigen::Vector3d(1.0, 0.0, 0.0));

// Create rotation axes (both along Z-axis)
Eigen::Vector3d axis1(0.0, 0.0, 1.0);
Eigen::Vector3d axis2(0.0, 0.0, 1.0);

// Create a gear constraint with 2:1 ratio
double gearRatio = 2.0;
auto gearConstraint = std::make_shared<GearConstraint>(
    gear1, gear2, axis1, axis2, gearRatio
);

// Set an angular velocity
Eigen::Vector3d linearVelocity = Eigen::Vector3d::Zero();
Eigen::Vector3d angularVelocity(0.0, 0.0, 1.0); // 1 rad/s around Z-axis
gearConstraint->setVelocity(linearVelocity, angularVelocity);

// Simulate for 1 second
double dt = 1.0;
gearConstraint->simulateMotion(dt);

// Calculate forces and torques
Eigen::Vector3d force, torque;
gearConstraint->calculateForceAndTorque(force, torque);
```

## Testing

Each constraint type has a corresponding test file that verifies its functionality:

- **GearConstraintTests.cpp**: Tests for GearConstraint
- **CamConstraintTests.cpp**: Tests for CamConstraint
- **PathConstraintTests.cpp**: Tests for PathConstraint
- etc.

These tests verify that the constraints correctly enforce the desired relationships, simulate motion, and calculate forces and torques.

## Future Enhancements

- **Constraint Solver**: Implement a comprehensive constraint solver for handling multiple constraints simultaneously
- **Constraint Optimization**: Optimize constraint enforcement for better performance
- **Constraint Visualization**: Add visualization tools for constraints
- **Constraint Animation**: Add animation capabilities for constraints
- **Constraint Export**: Add export capabilities for constraints to other formats (e.g., STEP, IGES)
